# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ iiko

Comprehensive guide for iiko Cloud API synchronization

## –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ iiko-base –ø–æ–∑–≤–æ–ª—è–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞—Ç—å –∏ —Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ iiko Cloud API –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö PostgreSQL. –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:

- ‚úÖ –ë—ã—Å—Ç—Ä—É—é —Ä–∞–±–æ—Ç—É —Å–∞–π—Ç–∞/–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–¥–∞–Ω–Ω—ã–µ –±–µ—Ä—É—Ç—Å—è –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î, –∞ –Ω–µ –∏–∑ iiko API –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ)
- ‚úÖ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏–∏ (SEO, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, —Ç–µ–≥–∏, –≤–∏–¥–∏–º–æ—Å—Ç—å)
- ‚úÖ –û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å (—Ä–∞–±–æ—Ç–∞ –ø—Ä–∏ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ iiko API)
- ‚úÖ –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –¥–∞–Ω–Ω—ã–º–∏ –º–µ–Ω—é

## –ß—Ç–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è

### 1. –ù–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∞ (–º–µ–Ω—é)
- **–ö–∞—Ç–µ–≥–æ—Ä–∏–∏** (`/api/1/nomenclature` ‚Üí groups)
  - –ò–µ—Ä–∞—Ä—Ö–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Å parent-child —Å–≤—è–∑—è–º–∏
  - –ù–∞–∑–≤–∞–Ω–∏—è, –æ–ø–∏—Å–∞–Ω–∏—è, —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
  - –õ–æ–∫–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–≤–∏–¥–∏–º–æ—Å—Ç—å, SEO)

- **–¢–æ–≤–∞—Ä—ã/–ë–ª—é–¥–∞** (`/api/1/nomenclature` ‚Üí items)
  - –ü–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–ª—é–¥–∞—Ö
  - –¶–µ–Ω—ã, –≤–µ—Å, –ö–ë–ñ–£
  - –ö–æ–¥—ã, –∞—Ä—Ç–∏–∫—É–ª—ã
  - –ü—Ä–∏–≤—è–∑–∫–∞ –∫ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º

- **–ú–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã** (`/api/1/nomenclature` ‚Üí modifiers)
  - –ì—Ä—É–ø–ø—ã –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤
  - –û—Ç–¥–µ–ª—å–Ω—ã–µ –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã
  - –ü—Ä–∞–≤–∏–ª–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è (min/max –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ)

### 2. –°—Ç–æ–ø-–ª–∏—Å—Ç—ã
- –ü–æ–∑–∏—Ü–∏–∏, –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã–µ –¥–ª—è –∑–∞–∫–∞–∑–∞
- –û—Å—Ç–∞—Ç–∫–∏ –ø–æ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞–º
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Ç–æ–≤–∞—Ä–æ–≤

### 3. –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏
- **–¢–µ—Ä–º–∏–Ω–∞–ª—å–Ω—ã–µ –≥—Ä—É–ø–ø—ã** - —Ç–æ—á–∫–∏ –ø—Ä–æ–¥–∞–∂/–¥–æ—Å—Ç–∞–≤–∫–∏
- **–¢–∏–ø—ã –æ–ø–ª–∞—Ç** - –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã –æ–ø–ª–∞—Ç—ã
- **–¶–µ–Ω–æ–≤—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏** - —Ä–∞–∑–ª–∏—á–Ω—ã–µ –ø—Ä–∞–π—Å-–ª–∏—Å—Ç—ã
- **–í–Ω–µ—à–Ω–∏–µ –º–µ–Ω—é** - —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –º–µ–Ω—é –¥–ª—è web/mobile

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
iiko Cloud API
    ‚Üì
Backend (FastAPI)
    ‚Üì
IikoSyncService
    ‚Üì
PostgreSQL (–ª–æ–∫–∞–ª—å–Ω–∞—è –ë–î)
    ‚Üì
Web/Mobile App
```

## –¢–∞–±–ª–∏—Ü—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

| –¢–∞–±–ª–∏—Ü–∞ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –ò—Å—Ç–æ—á–Ω–∏–∫ iiko API |
|---------|-----------|-------------------|
| `categories` | –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –º–µ–Ω—é | `/nomenclature` ‚Üí groups |
| `products` | –¢–æ–≤–∞—Ä—ã/–±–ª—é–¥–∞ | `/nomenclature` ‚Üí items |
| `product_sizes` | –†–∞–∑–º–µ—Ä—ã –ø–æ—Ä—Ü–∏–π | `/nomenclature` ‚Üí sizes |
| `modifiers` | –ú–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã | `/nomenclature` ‚Üí modifiers |
| `modifier_groups` | –ì—Ä—É–ø–ø—ã –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤ | `/nomenclature` ‚Üí groups.modifierSchema |
| `combos` | –ö–æ–º–±–æ-–Ω–∞–±–æ—Ä—ã | `/combo` |
| `stop_lists` | –°—Ç–æ–ø-–ª–∏—Å—Ç—ã | `/out_of_stock` |
| `terminal_groups` | –¢–µ—Ä–º–∏–Ω–∞–ª—ã | `/terminal_groups` |
| `payment_types` | –¢–∏–ø—ã –æ–ø–ª–∞—Ç | `/payment_types` |
| `price_categories` | –¶–µ–Ω–æ–≤—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ | `/organizations` ‚Üí priceCategories |
| `external_menus` | –í–Ω–µ—à–Ω–∏–µ –º–µ–Ω—é | `/menu` |

### –°–ª—É–∂–µ–±–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã

| –¢–∞–±–ª–∏—Ü–∞ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|---------|-----------|
| `sync_history` | –ò—Å—Ç–æ—Ä–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–π (—Å—Ç–∞—Ç—É—Å, –≤—Ä–µ–º—è, –æ—à–∏–±–∫–∏) |
| `webhook_configs` | –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–µ–±—Ö—É–∫–æ–≤ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è |

## API Endpoints

### –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

#### POST `/api/v1/sync/full`
–ü–æ–ª–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
```json
{
  "setting_id": 1
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "status": "success",
  "duration_ms": 5234,
  "results": {
    "categories": {
      "status": "success",
      "synced": 15,
      "duration_ms": 1200
    },
    "products": {
      "status": "success",
      "synced": 87,
      "duration_ms": 2400
    },
    ...
  }
}
```

#### POST `/api/v1/sync/menu`
–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ç–æ–ª—å–∫–æ –º–µ–Ω—é (–∫–∞—Ç–µ–≥–æ—Ä–∏–∏, —Ç–æ–≤–∞—Ä—ã, –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã)

#### POST `/api/v1/sync/stoplist`
–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å—Ç–æ–ø-–ª–∏—Å—Ç–æ–≤ (–±—ã—Å—Ç—Ä–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è)

#### POST `/api/v1/sync/terminals`
–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω—ã—Ö –≥—Ä—É–ø–ø

#### POST `/api/v1/sync/payments`
–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ç–∏–ø–æ–≤ –æ–ø–ª–∞—Ç

### –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

#### GET `/api/v1/data/categories`
–ü–æ–ª—É—á–∏—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏

#### GET `/api/v1/data/products`
–ü–æ–ª—É—á–∏—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `category_id` - —Ñ–∏–ª—å—Ç—Ä –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- `is_available` - —Ç–æ–ª—å–∫–æ –¥–æ—Å—Ç—É–ø–Ω—ã–µ/–Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã–µ
- `limit` - –ª–∏–º–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 100)
- `offset` - —Å–º–µ—â–µ–Ω–∏–µ –¥–ª—è –ø–∞–≥–∏–Ω–∞—Ü–∏–∏

#### GET `/api/v1/data/stop-lists`
–ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–∏–µ —Å—Ç–æ–ø-–ª–∏—Å—Ç—ã

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `organization_id` - ID –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)

### –ò—Å—Ç–æ—Ä–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–π

#### GET `/api/v1/sync/history`
–ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–π

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `organization_id` - —Ñ–∏–ª—å—Ç—Ä –ø–æ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
- `limit` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 50)

**–û—Ç–≤–µ—Ç:**
```json
{
  "history": [
    {
      "id": 123,
      "organization_id": "org-uuid",
      "sync_type": "full",
      "status": "success",
      "items_synced": 102,
      "duration_ms": 5234,
      "started_at": "2024-01-15T10:30:00Z",
      "completed_at": "2024-01-15T10:30:05Z"
    }
  ]
}
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏

### –í–∫–ª–∞–¥–∫–∞ "–î–∞–Ω–Ω—ã–µ iiko"

1. **–í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫—É iiko** –∏–∑ —Å–ø–∏—Å–∫–∞
2. **–ó–∞–≥—Ä—É–∑–∏—Ç–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏** - –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π
3. **–í—ã–±–µ—Ä–∏—Ç–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é** –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

#### –ö–Ω–æ–ø–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:

- **üîÑ –ü–æ–ª–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è** - —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–µ)
- **üìã –ú–µ–Ω—é** - –æ–±–Ω–æ–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, —Ç–æ–≤–∞—Ä—ã, –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã
- **üö´ –°—Ç–æ–ø-–ª–∏—Å—Ç—ã** - –æ–±–Ω–æ–≤–∏—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∑–∞–ø—É—Å–∫–∞—Ç—å —á–∞—Å—Ç–æ)
- **üè™ –¢–µ—Ä–º–∏–Ω–∞–ª—ã** - –æ–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–≤
- **üí≥ –¢–∏–ø—ã –æ–ø–ª–∞—Ç** - –æ–±–Ω–æ–≤–∏—Ç—å —Å–ø–æ—Å–æ–±—ã –æ–ø–ª–∞—Ç—ã

#### –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö:

–ü–æ—Å–ª–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –∫–Ω–æ–ø–∫–∏ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞:

- **üìÇ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏** - –∏–µ—Ä–∞—Ä—Ö–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏
- **üçï –¢–æ–≤–∞—Ä—ã** - —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ —Å —Ü–µ–Ω–∞–º–∏ –∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å—é
- **üö´ –°—Ç–æ–ø-–ª–∏—Å—Ç—ã** - –ø–æ–∑–∏—Ü–∏–∏, –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã–µ –¥–ª—è –∑–∞–∫–∞–∑–∞

#### –ò—Å—Ç–æ—Ä–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–π:

–¢–∞–±–ª–∏—Ü–∞ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏—è—Ö —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:
- –¢–∏–ø —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- –°—Ç–∞—Ç—É—Å (—É—Å–ø–µ—Ö/–æ—à–∏–±–∫–∞)
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π
- –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è
- –¢–µ–∫—Å—Ç –æ—à–∏–±–∫–∏ (–µ—Å–ª–∏ –±—ã–ª–∞)

## –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

–î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å CRON:

| –ü—Ä–æ—Ü–µ—Å—Å | –ß–∞—Å—Ç–æ—Ç–∞ | –ö–æ–º–∞–Ω–¥–∞ |
|---------|---------|---------|
| –ü–æ–ª–Ω–æ–µ –º–µ–Ω—é | 1 —Ä–∞–∑ –≤ —á–∞—Å | `0 * * * *` |
| –°—Ç–æ–ø-–ª–∏—Å—Ç—ã | –∫–∞–∂–¥—ã–µ 3 –º–∏–Ω | `*/3 * * * *` |
| –¶–µ–Ω—ã | –∫–∞–∂–¥—ã–µ 10 –º–∏–Ω | `*/10 * * * *` |
| –¢–µ—Ä–º–∏–Ω–∞–ª—ã | –∫–∞–∂–¥—ã–µ 10 –º–∏–Ω | `*/10 * * * *` |
| –¢–∏–ø—ã –æ–ø–ª–∞—Ç | 1 —Ä–∞–∑ –≤ —Å—É—Ç–∫–∏ | `0 4 * * *` |

### –ü—Ä–∏–º–µ—Ä –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ CRON

```bash
# /etc/crontab –∏–ª–∏ crontab -e

# –°—Ç–æ–ø-–ª–∏—Å—Ç—ã –∫–∞–∂–¥—ã–µ 3 –º–∏–Ω—É—Ç—ã
*/3 * * * * curl -X POST http://localhost:8000/api/v1/sync/stoplist \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"setting_id": 1}'

# –ú–µ–Ω—é –∫–∞–∂–¥—ã–π —á–∞—Å
0 * * * * curl -X POST http://localhost:8000/api/v1/sync/menu \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"setting_id": 1}'
```

## Webhook –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è

–î–ª—è –º–æ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –≤–µ–±—Ö—É–∫–∏:

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É **üîó –í–µ–±—Ö—É–∫–∏** –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
2. –í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫—É iiko
3. –í–≤–µ–¥–∏—Ç–µ –¥–æ–º–µ–Ω –∏–ª–∏ –ø–æ–ª–Ω—ã–π URL –≤–µ–±—Ö—É–∫–∞
4. –ù–∞–∂–º–∏—Ç–µ **–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –≤–µ–±—Ö—É–∫**
5. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É **üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å** –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

–í–µ–±—Ö—É–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–≤–µ–¥–æ–º–ª—è—é—Ç —Å–∏—Å—Ç–µ–º—É –æ:
- –ò–∑–º–µ–Ω–µ–Ω–∏—è—Ö —Å—Ç–∞—Ç—É—Å–æ–≤ –∑–∞–∫–∞–∑–æ–≤
- –û–±–Ω–æ–≤–ª–µ–Ω–∏—è—Ö —Å—Ç–æ–ø-–ª–∏—Å—Ç–æ–≤
- –û—à–∏–±–∫–∞—Ö –æ–±—Ä–∞–±–æ—Ç–∫–∏

## –õ–æ–∫–∞–ª—å–Ω–∞—è –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è

–ü–æ—Å–ª–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã–µ –º–æ–∂–Ω–æ –∫–∞—Å—Ç–æ–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å:

### –ö–∞—Ç–µ–≥–æ—Ä–∏–∏

```sql
-- –°–∫—Ä—ã—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é
UPDATE categories SET is_visible = FALSE WHERE id = 'cat-uuid';

-- –î–æ–±–∞–≤–∏—Ç—å SEO
UPDATE categories SET 
  seo_title = '–í–∫—É—Å–Ω–∞—è –ø–∏—Ü—Ü–∞ –≤ –ú–æ—Å–∫–≤–µ',
  seo_description = '–î–æ—Å—Ç–∞–≤–∫–∞ —Å–≤–µ–∂–µ–π –ø–∏—Ü—Ü—ã –∑–∞ 30 –º–∏–Ω—É—Ç'
WHERE id = 'cat-uuid';

-- –ò–∑–º–µ–Ω–∏—Ç—å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É
UPDATE categories SET sort_order = 10 WHERE name = '–•–∏—Ç—ã –ø—Ä–æ–¥–∞–∂';
```

### –¢–æ–≤–∞—Ä—ã

```sql
-- –°–∫—Ä—ã—Ç—å –±–ª—é–¥–æ –Ω–∞ —Å–∞–π—Ç–µ (–Ω–æ –æ–Ω–æ –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –≤ iiko)
UPDATE products SET is_visible = FALSE WHERE code = 'PIZZA-01';

-- –î–æ–±–∞–≤–∏—Ç—å —Ç–µ–≥–∏
UPDATE products SET tags = ARRAY['–≤–µ–≥–∞–Ω', '–æ—Å—Ç—Ä–æ–µ', '–Ω–æ–≤–∏–Ω–∫–∞'] 
WHERE id = 'prod-uuid';

-- –î–æ–±–∞–≤–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
UPDATE products SET image_urls = ARRAY[
  'https://cdn.example.com/pizza-1.jpg',
  'https://cdn.example.com/pizza-2.jpg'
] WHERE id = 'prod-uuid';
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

```sql
-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
SELECT * FROM sync_history 
ORDER BY started_at DESC 
LIMIT 10;

-- –ù–µ—É–¥–∞—á–Ω—ã–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
SELECT * FROM sync_history 
WHERE status = 'failed'
ORDER BY started_at DESC;

-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∏–ø–∞–º
SELECT 
  sync_type, 
  COUNT(*) as total,
  SUM(CASE WHEN status = 'success' THEN 1 ELSE 0 END) as success_count,
  AVG(duration_ms) as avg_duration_ms
FROM sync_history
GROUP BY sync_type;
```

### –õ–æ–≥–∏ API –∑–∞–ø—Ä–æ—Å–æ–≤

```sql
-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–ø—Ä–æ—Å—ã –∫ iiko API
SELECT * FROM api_logs 
ORDER BY created_at DESC 
LIMIT 20;

-- –û—à–∏–±–∫–∏ API
SELECT * FROM api_logs 
WHERE response_status >= 400
ORDER BY created_at DESC;
```

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ API –∫–ª—é—á–∞ –≤ —Ä–∞–∑–¥–µ–ª–µ **‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ API**
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Organization ID –∑–∞–ø–æ–ª–Ω–µ–Ω
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ —Ä–∞–∑–¥–µ–ª–µ **üìù –õ–æ–≥–∏**
4. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –∏—Å—Ç–æ—Ä–∏—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–π –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫

### –î–∞–Ω–Ω—ã–µ –Ω–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ `sync_history`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å —É—Å–ø–µ—à–Ω–æ (status = 'success')
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–ª–µ `synced_at` –≤ —Ç–∞–±–ª–∏—Ü–∞—Ö `categories`, `products`

### –°—Ç–æ–ø-–ª–∏—Å—Ç—ã –Ω–µ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è

1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å—Ç–æ–ø-–ª–∏—Å—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–∞–±–ª–∏—Ü—É `stop_lists` - —Ç–∞–º –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–ø–∏—Å–∏
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–ª–µ `is_available` –≤ —Ç–∞–±–ª–∏—Ü–µ `products`

## Python –∫–æ–¥ –¥–ª—è —Ä—É—á–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

```python
from app.iiko_sync import IikoSyncService
from database.connection import get_db
from database.models import IikoSettings

# –ü–æ–ª—É—á–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫—É iiko
db = next(get_db())
setting = db.query(IikoSettings).filter(IikoSettings.id == 1).first()

# –°–æ–∑–¥–∞—Ç—å —Å–µ—Ä–≤–∏—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
sync_service = IikoSyncService(db, setting)

# –ü–æ–ª–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
await sync_service.sync_all(setting.organization_id)

# –ò–ª–∏ —á–∞—Å—Ç–∏—á–Ω–∞—è
await sync_service.sync_categories(setting.organization_id)
await sync_service.sync_products(setting.organization_id)
await sync_service.sync_stop_lists(setting.organization_id)
```

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è iiko Cloud API](https://api-ru.iiko.services/docs)
- [iiko Cloud API –Ω–∞ GitHub](https://github.com/iiko)
- [apimenu.ru](https://apimenu.ru/info) - –ø—Ä–∏–º–µ—Ä—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π
- [–ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã](https://apimenu.ru/faq)

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑–¥–µ–ª "–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫" –≤—ã—à–µ
2. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ API –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–∞–±–ª–∏—Ü—É `sync_history` –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫
4. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ iiko Cloud API
