# –ü–æ–ª–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –≤—Ö–æ–¥–∞ –≤ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å

## –ü—Ä–æ–±–ª–µ–º–∞
–ü–æ—Å–ª–µ —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è –≤—Å–µ —Ä–∞–≤–Ω–æ –ø–∏—à–µ—Ç: **"–ù–µ–≤–µ—Ä–Ω—ã–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ"**. –ù–µ –º–æ–∂–µ—Ç–µ –≤–æ–π—Ç–∏ –≤ –∞–¥–º–∏–Ω–∫—É.

---

## üöÄ –ë—ã—Å—Ç—Ä–æ–µ —Ä–µ—à–µ–Ω–∏–µ (2 –º–∏–Ω—É—Ç—ã)

### –®–∞–≥ 1: –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

```bash
cd /var/www/iiko-base  # –∏–ª–∏ –≤–∞—à–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –ø—Ä–æ–µ–∫—Ç–∞
./scripts/diagnose_and_fix_admin.sh
```

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏**:
- –ü—Ä–æ–≤–µ—Ä–∏—Ç –≤—Å–µ 10 –≤–æ–∑–º–æ–∂–Ω—ã—Ö –ø—Ä–∏—á–∏–Ω –ø—Ä–æ–±–ª–µ–º—ã
- –ò—Å–ø—Ä–∞–≤–∏—Ç –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏
- –ü–æ–∫–∞–∂–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç

### –®–∞–≥ 2: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ backend

–ï—Å–ª–∏ —Å–∫—Ä–∏–ø—Ç –∏—Å–ø—Ä–∞–≤–∏–ª –æ—à–∏–±–∫–∏, –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ backend:

```bash
# –î–ª—è systemd:
sudo systemctl restart iiko-backend

# –î–ª—è Docker:
docker-compose restart backend
```

### –®–∞–≥ 3: –í–æ–π–¥–∏—Ç–µ –≤ –∞–¥–º–∏–Ω–∫—É

- **–õ–æ–≥–∏–Ω:** `admin`
- **–ü–∞—Ä–æ–ª—å:** `12101991Qq!`

‚ö†Ô∏è **–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Å–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª—å —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –≤—Ö–æ–¥–∞!**

---

## üîç –í—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–∏—á–∏–Ω–∞ 1: –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∫–æ–ª–æ–Ω–∫–∞ `role` –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö ‚≠ê –°–ê–ú–ê–Ø –ß–ê–°–¢–ê–Ø

**–°–∏–º–ø—Ç–æ–º—ã:**
- –ü–∞—Ä–æ–ª—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π, –Ω–æ –≤—Ö–æ–¥ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- –í –ª–æ–≥–∞—Ö backend –Ω–µ—Ç –æ—à–∏–±–æ–∫ –∏–ª–∏ —Å—Ç—Ä–∞–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏ SQL

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**
```bash
PGPASSWORD="12101991Qq!" psql -h localhost -U iiko_user -d iiko_db -c \
  "SELECT column_name FROM information_schema.columns WHERE table_name='users';"
```

–ï—Å–ª–∏ –≤ —Å–ø–∏—Å–∫–µ –Ω–µ—Ç `role`, `is_active`, `is_superuser` - —ç—Ç–æ –≤–∞—à–∞ –ø—Ä–æ–±–ª–µ–º–∞.

**–†–µ—à–µ–Ω–∏–µ:**
```bash
PGPASSWORD="12101991Qq!" psql -h localhost -U iiko_user -d iiko_db <<EOF
ALTER TABLE users ADD COLUMN IF NOT EXISTS role VARCHAR(20) DEFAULT 'viewer';
ALTER TABLE users ADD COLUMN IF NOT EXISTS is_active BOOLEAN DEFAULT TRUE;
ALTER TABLE users ADD COLUMN IF NOT EXISTS is_superuser BOOLEAN DEFAULT FALSE;
UPDATE users SET role = 'admin', is_active = TRUE, is_superuser = TRUE WHERE username = 'admin';
EOF
```

---

### –ü—Ä–∏—á–∏–Ω–∞ 2: –ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è admin –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**
```bash
PGPASSWORD="12101991Qq!" psql -h localhost -U iiko_user -d iiko_db -c \
  "SELECT username, role, is_active FROM users WHERE username = 'admin';"
```

–ï—Å–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—É—Å—Ç–æ–π - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —Å–æ–∑–¥–∞–Ω.

**–†–µ—à–µ–Ω–∏–µ:**
```bash
PGPASSWORD="12101991Qq!" psql -h localhost -U iiko_user -d iiko_db <<EOF
INSERT INTO users (username, email, hashed_password, role, is_active, is_superuser, created_at)
VALUES (
  'admin',
  'admin@example.com',
  '\$2b\$12\$y4QVNPhuZfpLp1.xM6.NSeDnpD6I/wm.dSOXGrxV.HtXj6izHJLPa',
  'admin',
  TRUE,
  TRUE,
  NOW()
)
ON CONFLICT (username) DO UPDATE SET
  hashed_password = EXCLUDED.hashed_password,
  role = EXCLUDED.role,
  is_active = EXCLUDED.is_active,
  is_superuser = EXCLUDED.is_superuser;
EOF
```

---

### –ü—Ä–∏—á–∏–Ω–∞ 3: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ö–µ—à –ø–∞—Ä–æ–ª—è –≤ –±–∞–∑–µ

**–°–∏–º–ø—Ç–æ–º—ã:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –Ω–æ –ª–æ–≥–∏–Ω –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- –•–µ—à –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `\$2b\$12\$` –≤–º–µ—Å—Ç–æ `$2b$12$`

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**
```bash
PGPASSWORD="12101991Qq!" psql -h localhost -U iiko_user -d iiko_db -c \
  "SELECT username, LEFT(hashed_password, 30) FROM users WHERE username = 'admin';"
```

**–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ö–µ—à:**
```
$2b$12$y4QVNPhuZfpLp1.xM6.NSeDnpD6I/wm.dSOXGrxV.HtXj6izHJLPa
```

**–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ö–µ—à (—Å —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º):**
```
\$2b\$12\$y4QVNPhuZfpLp1.xM6.NSeDnpD6I/wm.dSOXGrxV.HtXj6izHJLPa
```

**–†–µ—à–µ–Ω–∏–µ:**
```bash
./scripts/reset_admin_password.sh
```

---

### –ü—Ä–∏—á–∏–Ω–∞ 4: Backend –Ω–µ –∑–∞–ø—É—â–µ–Ω

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**
```bash
# –î–ª—è systemd:
sudo systemctl status iiko-backend

# –î–ª—è Docker:
docker-compose ps

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞:
ps aux | grep uvicorn
```

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –î–ª—è systemd:
sudo systemctl start iiko-backend
sudo systemctl enable iiko-backend

# –î–ª—è Docker:
docker-compose up -d backend

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤:
sudo journalctl -u iiko-backend -n 50
# –∏–ª–∏
docker-compose logs backend --tail=50
```

---

### –ü—Ä–∏—á–∏–Ω–∞ 5: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è backend/.env

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**
```bash
cat backend/.env | grep DATABASE_URL
```

–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```
DATABASE_URL=postgresql://iiko_user:12101991Qq!@localhost:5432/iiko_db
```

**–†–µ—à–µ–Ω–∏–µ:**
–ï—Å–ª–∏ —Ñ–∞–π–ª –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∏–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π:
```bash
cp backend/.env.example backend/.env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ DATABASE_URL –≤ backend/.env
```

---

### –ü—Ä–∏—á–∏–Ω–∞ 6: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è frontend/.env

**–°–∏–º–ø—Ç–æ–º—ã:**
- API —Ä–∞–±–æ—Ç–∞–µ—Ç (curl —É—Å–ø–µ—à–µ–Ω)
- –ù–æ —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä –≤—Ö–æ–¥ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**
```bash
cat frontend/.env | grep -E "BACKEND_API_URL|VITE_API_URL"
```

–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```
BACKEND_API_URL=http://localhost:8000/api/v1
# –∏–ª–∏
VITE_API_URL=http://localhost:8000/api/v1
```

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –°–æ–∑–¥–∞–π—Ç–µ –∏–ª–∏ –æ–±–Ω–æ–≤–∏—Ç–µ frontend/.env
echo "BACKEND_API_URL=http://localhost:8000/api/v1" >> frontend/.env
```

---

### –ü—Ä–∏—á–∏–Ω–∞ 7: PostgreSQL –Ω–µ –∑–∞–ø—É—â–µ–Ω

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**
```bash
sudo systemctl status postgresql
```

**–†–µ—à–µ–Ω–∏–µ:**
```bash
sudo systemctl start postgresql
sudo systemctl enable postgresql
```

---

### –ü—Ä–∏—á–∏–Ω–∞ 8: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å admin –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**
```bash
PGPASSWORD="12101991Qq!" psql -h localhost -U iiko_user -d iiko_db -c \
  "SELECT username, is_active FROM users WHERE username = 'admin';"
```

–ï—Å–ª–∏ `is_active = f` (false):

**–†–µ—à–µ–Ω–∏–µ:**
```bash
PGPASSWORD="12101991Qq!" psql -h localhost -U iiko_user -d iiko_db -c \
  "UPDATE users SET is_active = TRUE WHERE username = 'admin';"
```

---

### –ü—Ä–∏—á–∏–Ω–∞ 9: CORS –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã

**–°–∏–º–ø—Ç–æ–º—ã:**
- –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ (F12) –æ—à–∏–±–∫–∞ CORS
- Backend —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ frontend –Ω–µ –º–æ–∂–µ—Ç –∫ –Ω–µ–º—É –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**
–û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12), –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –≤–æ–π—Ç–∏ –∏ –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ –æ—à–∏–±–∫–∏.

**–†–µ—à–µ–Ω–∏–µ:**
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ `backend/config/settings.py`:
```python
BACKEND_CORS_ORIGINS: List[str] = [
    "http://localhost:3000",
    "http://localhost",
    "https://–≤–∞—à-–¥–æ–º–µ–Ω.ru",
]
```

–î–æ–±–∞–≤—å—Ç–µ –≤–∞—à –¥–æ–º–µ–Ω –≤ —Å–ø–∏—Å–æ–∫ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ backend.

---

### –ü—Ä–∏—á–∏–Ω–∞ 10: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —É–¥–∞–ª–µ–Ω–∞/–ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∞

**–°–∏–º–ø—Ç–æ–º—ã:**
- –†–∞–Ω—å—à–µ —Ä–∞–±–æ—Ç–∞–ª–æ, —Ç–µ–ø–µ—Ä—å –Ω–µ—Ç
- –ü–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –ø—Ä–æ–±–ª–µ–º–∞ –ø–æ—è–≤–∏–ª–∞—Å—å

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–∞–∑—ã:
cd /var/www/iiko-base
./scripts/setup.sh

# –ü—Ä–æ–≤–µ—Ä–∫–∞:
./scripts/diagnose_and_fix_admin.sh
```

---

## üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

### –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
```bash
./scripts/check_admin_db.sh
```

### –¢–µ—Å—Ç 2: –ü—Ä—è–º–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ API
```bash
curl -X POST http://localhost:8000/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"12101991Qq!"}'
```

**–£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç:**
```json
{
  "access_token": "eyJ0eXAiOiJKV1QiLCJhbGc...",
  "token_type": "bearer"
}
```

**–û—à–∏–±–∫–∞ 401:**
```json
{
  "detail": "–ù–µ–≤–µ—Ä–Ω—ã–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ"
}
```

### –¢–µ—Å—Ç 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä
1. –û—Ç–∫—Ä–æ–π—Ç–µ http://–≤–∞—à-–¥–æ–º–µ–Ω.ru/login
2. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ (F12)
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É Network
4. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤–æ–π—Ç–∏
5. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ —Å—Ç–∞—Ç—É—Å –∑–∞–ø—Ä–æ—Å–∞ –∫ `/api/v1/auth/login`

---

## üìä –¢–∞–±–ª–∏—Ü–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

| –°–∏–º–ø—Ç–æ–º | –í–µ—Ä–æ—è—Ç–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞ | –ë—ã—Å—Ç—Ä–æ–µ —Ä–µ—à–µ–Ω–∏–µ |
|---------|-------------------|-----------------|
| "–ù–µ–≤–µ—Ä–Ω—ã–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ" —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –≤–≤–æ–¥–∞ | –ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è admin –∏–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ö–µ—à | `./scripts/diagnose_and_fix_admin.sh` |
| "Connection refused" –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ | Backend –Ω–µ –∑–∞–ø—É—â–µ–Ω | `sudo systemctl start iiko-backend` |
| –û—à–∏–±–∫–∞ CORS –≤ –∫–æ–Ω—Å–æ–ª–∏ | –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ CORS | –î–æ–±–∞–≤–∏—Ç—å –¥–æ–º–µ–Ω –≤ `BACKEND_CORS_ORIGINS` |
| 502 Bad Gateway | Nginx –Ω–µ –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ backend | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ backend —Å–ª—É—à–∞–µ—Ç –Ω–∞ 8000 |
| "role" column does not exist –≤ –ª–æ–≥–∞—Ö | –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∫–æ–ª–æ–Ω–∫–∞ role | `./scripts/diagnose_and_fix_admin.sh` |
| –ü—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç –æ—Ç API | PostgreSQL –Ω–µ –∑–∞–ø—É—â–µ–Ω | `sudo systemctl start postgresql` |

---

## üîß –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∞ (–µ—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–º–æ–≥–ª–æ)

### –í–∞—Ä–∏–∞–Ω—Ç 1: –° —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –¥–∞–Ω–Ω—ã—Ö
```bash
cd /var/www/iiko-base

# –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è
./scripts/backup.sh

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã
sudo systemctl stop iiko-backend
sudo systemctl stop nginx

# –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–¥
git pull origin main

# –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
./scripts/setup.sh

# –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
./scripts/diagnose_and_fix_admin.sh

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã
sudo systemctl start iiko-backend
sudo systemctl start nginx
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ (‚ö†Ô∏è –£–î–ê–õ–ò–¢ –í–°–ï –î–ê–ù–ù–´–ï!)
```bash
# –î–ª—è Docker:
docker-compose down -v
docker-compose up -d

# –ë–µ–∑ Docker:
sudo -u postgres psql <<EOF
DROP DATABASE IF EXISTS iiko_db;
CREATE DATABASE iiko_db;
GRANT ALL PRIVILEGES ON DATABASE iiko_db TO iiko_user;
\c iiko_db
EOF

# –°–æ–∑–¥–∞—Ç—å —Å—Ö–µ–º—É
PGPASSWORD="12101991Qq!" psql -h localhost -U iiko_user -d iiko_db < database/schema.sql

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
./scripts/diagnose_and_fix_admin.sh
```

---

## üìù –õ–æ–≥–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –æ—Å—Ç–∞–µ—Ç—Å—è, —Å–æ–±–µ—Ä–∏—Ç–µ –ª–æ–≥–∏:

```bash
# Backend –ª–æ–≥–∏ (systemd)
sudo journalctl -u iiko-backend -n 100 > backend_logs.txt

# Backend –ª–æ–≥–∏ (Docker)
docker-compose logs backend --tail=100 > backend_logs.txt

# Nginx –ª–æ–≥–∏
tail -n 100 /var/log/nginx/error.log > nginx_logs.txt

# PostgreSQL –ª–æ–≥–∏
sudo tail -n 100 /var/log/postgresql/postgresql-*.log > postgres_logs.txt

# –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –±–∞–∑—ã
./scripts/diagnose_and_fix_admin.sh > diagnostic.txt 2>&1
```

–ü—Ä–∏–ª–æ–∂–∏—Ç–µ —ç—Ç–∏ —Ñ–∞–π–ª—ã –ø—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∑–∞ –ø–æ–º–æ—â—å—é.

---

## üéØ –£—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

**–õ–æ–≥–∏–Ω:** `admin`  
**–ü–∞—Ä–æ–ª—å:** `12101991Qq!`  
**Email:** `admin@example.com`  
**–•–µ—à –ø–∞—Ä–æ–ª—è:** `$2b$12$y4QVNPhuZfpLp1.xM6.NSeDnpD6I/wm.dSOXGrxV.HtXj6izHJLPa`

‚ö†Ô∏è **–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:** –°–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª—å —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –≤—Ö–æ–¥–∞!

---

## üÜò –ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å?

1. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É:**
   ```bash
   ./scripts/diagnose_and_fix_admin.sh > diagnostics.txt 2>&1
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ API –Ω–∞–ø—Ä—è–º—É—é:**
   ```bash
   curl -v -X POST http://localhost:8000/api/v1/auth/login \
     -H "Content-Type: application/json" \
     -d '{"username":"admin","password":"12101991Qq!"}' 2>&1 | tee api_test.txt
   ```

3. **–°–æ–±–µ—Ä–∏—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–∏—Å—Ç–µ–º–µ:**
   ```bash
   uname -a > system_info.txt
   docker --version >> system_info.txt
   psql --version >> system_info.txt
   python3 --version >> system_info.txt
   ```

4. **–°–æ–∑–¥–∞–π—Ç–µ issue –Ω–∞ GitHub** —Å —Ñ–∞–π–ª–∞–º–∏:
   - diagnostics.txt
   - api_test.txt
   - system_info.txt
   - backend_logs.txt

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–π —Å–ø–∏—Å–æ–∫ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

- [ ] –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö PostgreSQL –∑–∞–ø—É—â–µ–Ω–∞
- [ ] –¢–∞–±–ª–∏—Ü–∞ `users` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- [ ] –ö–æ–ª–æ–Ω–∫–∞ `role` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ —Ç–∞–±–ª–∏—Ü–µ users
- [ ] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å `admin` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- [ ] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å `admin` –∞–∫—Ç–∏–≤–µ–Ω (`is_active = true`)
- [ ] –•–µ—à –ø–∞—Ä–æ–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `$2b$12$`)
- [ ] Backend –∑–∞–ø—É—â–µ–Ω –∏ –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 8000
- [ ] API –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ `/api/v1/auth/login`
- [ ] –§–∞–π–ª `backend/.env` –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- [ ] –§–∞–π–ª `frontend/.env` –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- [ ] CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è –≤–∞—à–µ–≥–æ –¥–æ–º–µ–Ω–∞

---

**–ê–≤—Ç–æ—Ä:** dovezukatmn  
**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞:** 2.0  
**–î–∞—Ç–∞:** 2026-02-09
